# API Reference

This document describes the structure of the generated code.

## Generated File Structure

The plugin generates a single file (`graphql.ts`) containing:

1. GraphQL documents (gql template literals)
2. `GraphqlCustomClient` class with methods for each operation

## GraphQL Documents

Each operation generates a document constant:

```typescript
export const GetUsersDocument = gql`
  query GetUsers {
    users {
      id
      name
      email
    }
  }
`;

export const CreateUserDocument = gql`
  mutation CreateUser($name: String!, $email: String!) {
    createUser(name: $name, email: $email) {
      id
      name
      email
    }
  }
`;
```

## GraphqlCustomClient Class

The main class that provides methods for all operations:

```typescript
export class GraphqlCustomClient {
  private readonly client: ApolloClient<any>;

  constructor(options: ApolloClientOptions<any>) {
    this.client = new ApolloClient({
      ssrMode: true,
      cache: new InMemoryCache(),
      defaultOptions: {
        watchQuery: {
          fetchPolicy: 'network-only',
        },
      },
      ...options,
    });
  }

  protected getCustomVariables<TVariables = Record<string, unknown>>(
    variables?: TVariables
  ): TVariables {
    return {
      ...variables,
    } as TVariables;
  }

  // Generated methods for each operation
  async getUsers(
    variables?: GetUsersQueryVariables,
    context?: any
  ): Promise<ApolloQueryResult<GetUsersQuery>> {
    const response = await this.client.query<GetUsersQuery, GetUsersQueryVariables>({
      query: GetUsersDocument,
      variables: this.getCustomVariables<GetUsersQueryVariables>(variables),
      context,
    });
    return response;
  }

  async postCreateUser(
    variables?: CreateUserMutationVariables,
    context?: any
  ): Promise<ApolloQueryResult<CreateUserMutation>> {
    const response = await this.client.mutate<CreateUserMutation, CreateUserMutationVariables>({
      mutation: CreateUserDocument,
      variables: this.getCustomVariables<CreateUserMutationVariables>(variables),
      context,
    });
    return response;
  }
}
```

## Method Naming Convention

- **Queries**: `get{OperationName}`
  - Example: `GetUsers` → `getUsers`
  - Example: `GetUserById` → `getGetUserById`

- **Mutations**: `post{OperationName}`
  - Example: `CreateUser` → `postCreateUser`
  - Example: `UpdateUser` → `postUpdateUser`

- **Subscriptions**: `post{OperationName}`
  - Example: `UserUpdated` → `postUserUpdated`

## Type Generation

Types are generated by `typescript-operations` plugin and follow this pattern:

- **Query Types**: `{OperationName}Query`, `{OperationName}QueryVariables`
- **Mutation Types**: `{OperationName}Mutation`, `{OperationName}MutationVariables`
- **Subscription Types**: `{OperationName}Subscription`, `{OperationName}SubscriptionVariables`

Example:

```typescript
// For query: GetUsers
type GetUsersQuery = { ... };
type GetUsersQueryVariables = { ... };

// For mutation: CreateUser
type CreateUserMutation = { ... };
type CreateUserMutationVariables = { ... };
```

## Return Types

All methods return a `Promise<ApolloQueryResult<T>>` or `Promise<ApolloMutationResult<T>>`:

```typescript
interface ApolloQueryResult<T> {
  data?: T;
  loading: boolean;
  error?: ApolloError;
  networkStatus: NetworkStatus;
  // ... other Apollo Client properties
}
```

## Constructor Options

The constructor accepts `ApolloClientOptions<any>`, allowing you to configure all Apollo Client options including cache, defaultOptions, ssrMode, and more. Default values are merged with your options, with your options taking precedence.

### Default Values

The following defaults are applied if not specified:

- `ssrMode: true`
- `cache: new InMemoryCache()`
- `defaultOptions.watchQuery.fetchPolicy: 'network-only'`

### Example: Custom Cache Configuration

```typescript
import { HttpLink, InMemoryCache } from '@apollo/client';
import { GraphqlCustomClient } from '@/graphql/graphql';

const client = new GraphqlCustomClient({
  link: new HttpLink({ uri: 'https://api.example.com/graphql' }),
  cache: new InMemoryCache({
    typePolicies: {
      Query: {
        fields: {
          // Custom cache policies
        },
      },
    },
  }),
  defaultOptions: {
    watchQuery: {
      fetchPolicy: 'cache-and-network',
    },
  },
});
```

### Example: Overriding Default Options

```typescript
import { HttpLink, InMemoryCache } from '@apollo/client';
import { GraphqlCustomClient } from '@/graphql/graphql';

const client = new GraphqlCustomClient({
  link: new HttpLink({ uri: 'https://api.example.com/graphql' }),
  cache: new InMemoryCache(),
  ssrMode: false, // Override default
  connectToDevTools: true, // Additional option
});
```

## Custom Variables Hook

The `getCustomVariables` method can be overridden in a subclass to transform variables:

```typescript
class CustomGraphqlClient extends GraphqlCustomClient {
  protected getCustomVariables<TVariables>(variables?: TVariables): TVariables {
    // Add default values or transform variables
    return {
      ...variables,
      timestamp: Date.now(),
    } as TVariables;
  }
}
```

